# SDK 开发测试环境

这个目录是 SDK 的开发测试环境，直接引用 SDK 的源码文件，无需构建和发布即可进行开发和测试。

## 🚀 快速开始

### 1. 安装依赖

```bash
cd demo/dev
pnpm install
```

### 2. 启动开发服务器

```bash
pnpm dev
```

开发服务器将在 `http://localhost:5174` 启动。

## 🔧 工作原理

### 源码直接引用

在 `vite.config.ts` 中配置了路径别名，直接引用 SDK 源码：

```typescript
resolve: {
  alias: {
    '@ppyuesheng/loki-sdk-h5-core': resolve(__dirname, '../../packages/core/src/index.ts'),
    '@ppyuesheng/loki-sdk-h5-transport-loki': resolve(__dirname, '../../packages/transport-loki/src/index.ts'),
    // ... 其他包
  },
}
```

### 实时开发

- 修改 SDK 源码后，刷新页面即可看到效果
- 无需构建和发布包
- 支持热重载和实时调试

## 🧪 测试功能

### 基础功能测试

- **基础初始化**: 测试 SDK 的基本初始化功能
- **日志记录**: 测试不同级别的日志记录
- **错误捕获**: 测试手动错误捕获功能
- **上下文管理**: 测试用户和上下文设置

### 传输模式测试

- **直接模式**: 测试直接连接 Loki 服务器
- **代理模式**: 测试通过 Vite 代理连接
- **CORS代理模式**: 测试通过 CORS 代理服务连接

### 错误触发测试

- **JS 错误**: 触发 JavaScript 运行时错误
- **Promise 拒绝**: 触发未处理的 Promise 拒绝
- **资源加载错误**: 触发资源加载失败

### 工具功能

- **清空日志**: 清除当前页面的日志
- **导出日志**: 将日志导出为文本文件
- **性能测试**: 测试 SDK 的性能表现

## 📁 目录结构

```
demo/dev/
├── src/
│   └── main.ts          # 主入口文件
├── index.html           # 主页面
├── package.json         # 项目配置
├── vite.config.ts       # Vite 配置
├── tsconfig.json        # TypeScript 配置
└── README.md           # 说明文档
```

## 🔍 调试技巧

### 1. 浏览器开发者工具

- 在 Sources 面板中可以直接查看和调试 SDK 源码
- 在 Console 面板中查看详细的日志输出
- 在 Network 面板中监控网络请求

### 2. 源码调试

```typescript
// 在 main.ts 中添加调试代码
console.log('SDK 配置:', sdkH5);
console.log('传输层:', sdkH5.transport);
```

### 3. 网络请求调试

在浏览器开发者工具的 Network 面板中：
- 查看请求是否发送到正确的代理路径
- 检查请求头和响应头
- 验证 CORS 配置是否正确

## 🚨 注意事项

### 1. 端口冲突

开发环境使用端口 5174，避免与生产环境（5173）冲突。

### 2. 源码依赖

确保 SDK 源码文件存在且路径正确：
- `../../packages/core/src/index.ts`
- `../../packages/transport-loki/src/index.ts`
- 等等

### 3. 代理配置

开发环境配置了 Vite 代理来处理 CORS 问题：
- 代理路径：`/api/loki`
- 目标服务器：`http://47.77.196.223:3100`

## 🔄 开发流程

1. **修改 SDK 源码**：在 `packages/` 目录下修改源码
2. **刷新页面**：在浏览器中刷新开发环境页面
3. **测试功能**：使用页面上的测试按钮验证功能
4. **调试问题**：使用浏览器开发者工具进行调试
5. **确认无误**：功能确认无误后，再构建和发布包

## 📝 与生产环境的区别

| 特性 | 开发环境 | 生产环境 |
|------|----------|----------|
| 源码引用 | 直接引用源码 | 引用发布的包 |
| 构建需求 | 无需构建 | 需要构建和发布 |
| 调试能力 | 完整的源码调试 | 只能调试编译后的代码 |
| 热重载 | 支持 | 不支持 |
| 端口 | 5174 | 5173 |

## 🎯 最佳实践

1. **开发阶段**：使用开发环境进行功能开发和调试
2. **测试阶段**：使用生产环境验证发布包的功能
3. **问题排查**：在开发环境中复现和修复问题
4. **性能测试**：在两个环境中都进行性能测试对比

## 🆘 常见问题

### Q: 页面无法加载 SDK 源码？
A: 检查路径别名配置是否正确，确保 SDK 源码文件存在。

### Q: 代理请求失败？
A: 检查 Vite 代理配置，确保目标服务器可访问。

### Q: TypeScript 类型错误？
A: 检查 `tsconfig.json` 中的路径映射配置。

### Q: 热重载不工作？
A: 确保 Vite 配置中的 `optimizeDeps.include` 包含了 SDK 源码文件。
